// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// User & Authentication Models
// ============================================

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  name      String
  password  String
  avatarUrl String?
  preferredLanguage String @default("en")  // 'en' | 'id'
  preferredCurrency String @default("USD") // 'USD' | 'IDR' | 'EUR'

  // Transaction display settings
  transactionTimeRange String @default("weekly") // 'daily' | 'weekly' | 'monthly'
  firstDayOfWeek       Int    @default(0)        // 0=Sunday, 1=Monday, ..., 6=Saturday

  // Relationships
  subscription Subscription?
  wallets      Wallet[]
  transactions Transaction[]
  categories   Category[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Subscription {
  id          String    @id @default(cuid())
  userId      String    @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  tier        String    @default("free") // 'free' | 'pro_trial' | 'pro' | 'pro_plus'
  isActive    Boolean   @default(true)
  startDate   DateTime  @default(now())
  endDate     DateTime? // When subscription expires (paid plans & pro_trial)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("subscriptions")
}

// ============================================
// Wallet Models
// ============================================

model Wallet {
  id        String        @id @default(cuid())
  userId    String
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  balance   Float         @default(0)
  currency  String        @default("USD")
  color     String?
  icon      String?

  // Relationships
  transactions Transaction[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
  @@index([userId])
  @@map("wallets")
}

// ============================================
// Category Models (Pro / Pro Trial)
// ============================================

model Category {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  type      String   // 'income' | 'expense'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name, type])
  @@index([userId])
  @@map("categories")
}

// ============================================
// Transaction Models
// ============================================

model Transaction {
  id          String   @id @default(cuid())
  walletId    String
  wallet      Wallet   @relation(fields: [walletId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        String   // 'income' or 'expense'
  category    String   // 'salary', 'food', 'transport', etc.
  amount      Float
  description String
  date        DateTime

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([walletId])
  @@index([userId])
  @@index([date])
  @@map("transactions")
}

// ============================================
// FX Rates (cached from external API)
// ============================================

model FxRate {
  id        String   @id @default("default")
  baseCode  String   @default("USD")
  rates     Json     // { "USD": 1, "IDR": 16862, "EUR": 0.92, ... }
  updatedAt DateTime @updatedAt

  @@map("fx_rates")
}

